<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Openshift-diy-mojolicious by thunderpick</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Openshift-diy-mojolicious</h1>
      <h2 class="project-tagline">Run Mojolicious in Openshift DIY cartrige</h2>
      <a href="https://github.com/thunderpick/openshift-diy-mojolicious" class="btn">View on GitHub</a>
      <a href="https://github.com/thunderpick/openshift-diy-mojolicious/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/thunderpick/openshift-diy-mojolicious/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="openshift-diy-mojolicious" class="anchor" href="#openshift-diy-mojolicious" aria-hidden="true"><span class="octicon octicon-link"></span></a>openshift-diy-mojolicious</h1>

<p>Steps to support Perl 5.16 or newer version on OpenShift.com</p>

<h2>
<a id="steps" class="anchor" href="#steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Steps:</h2>

<p>Create new app using diy-0.1 cartridge:</p>

<pre><code>rhc app create diy diy-0.1
rhc ssh -a diy
</code></pre>

<p>Download &amp; Build new version of Perl from source:</p>

<pre><code>cd $OPENSHIFT_DATA_DIR
mkdir download
cd download
wget -c -nd http://www.cpan.org/src/5.0/perl-5.16.3.tar.gz
tar -xf perl-5.16.3.tar.gz
cd perl-5.16.3
./Configure -des -Dprefix="$OPENSHIFT_DATA_DIR/perl"
make 
make install
cd "$OPENSHIFT_DATA_DIR/perl/bin"
./perl -v
</code></pre>

<p>Then install additional Perl modules:</p>

<pre><code>cd "$OPENSHIFT_DATA_DIR/perl/bin"
HOME=$OPENSHIFT_DATA_DIR ./perl cpan
&gt; cpan[1]    notest install Mojolicious and_other_modules
&gt; quit
</code></pre>

<h2>
<a id="roll-your-own-webserver" class="anchor" href="#roll-your-own-webserver" aria-hidden="true"><span class="octicon octicon-link"></span></a>Roll your own webserver</h2>

<p>To start your own web server run on host $OPENSHIFT_DIY_IP and on port $OPENSHIFT_DIY_PORT (usually port 8080)  :</p>

<pre><code>"$OPENSHIFT_DATA_DIR/perl/bin/morbo" --listen 'http://$OPENSHIFT_DIY_IP:$OPENSHIFT_DIY_PORT' "$OPENSHIFT_REPO_DIR/diy/script/diy"
</code></pre>

<p>However, Please edit this file:</p>

<pre><code>.openshift/action_hooks/start
</code></pre>

<p>to </p>

<pre><code>#!/bin/bash
MOJO_HOME="$OPENSHIFT_REPO_DIR/diy" "$OPENSHIFT_DATA_DIR/perl/bin/morbo" \
          --listen="http://$OPENSHIFT_DIY_IP:$OPENSHIFT_DIY_PORT" \
          "$OPENSHIFT_REPO_DIR/diy/script/diy" |&amp; /usr/bin/logshifter -tag diy &amp;
</code></pre>

<p>to autostart your webserver.</p>

<p>and also:</p>

<pre><code>.openshift/action_hooks/stop
</code></pre>

<p>to</p>

<pre><code>#!/bin/bash
source $OPENSHIFT_CARTRIDGE_SDK_BASH

# The logic to stop your application should be put in this script.
if [ -z "$(ps -ef | grep diy | grep -v grep)" ]
then
    client_result "Application is already stopped"
else
    kill `ps -ef | grep diy | grep -v grep | awk '{ print $2 }'` &gt; /dev/null 2&gt;&amp;1
fi
</code></pre>

<p>to stop your webserver.</p>

<p>Also replace in "diy/script/diy"</p>

<pre><code>this:
    "use lib 'lib';"

to:
    use lib $ENV{OPENSHIFT_REPO_DIR} . '/diy/lib';
</code></pre>

<h2>
<a id="test-on-your-browser" class="anchor" href="#test-on-your-browser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test on your browser:</h2>

<pre><code>http://[diy]-[yourdomain].rhcloud.com
</code></pre>

<h2>
<a id="maintenance" class="anchor" href="#maintenance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maintenance</h2>

<p>To stop/start/restart your app:</p>

<pre><code>rhc ssh -a diy

rhc app stop -a diy
rhc app start -a diy
rhc app restart -a diy
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/thunderpick/openshift-diy-mojolicious">Openshift-diy-mojolicious</a> is maintained by <a href="https://github.com/thunderpick">thunderpick</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
